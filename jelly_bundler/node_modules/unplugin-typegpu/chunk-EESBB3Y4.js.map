{"version":3,"sources":["../src/bun.ts"],"sourcesContent":["import type { BunPlugin } from 'bun';\nimport * as Babel from '@babel/standalone';\nimport defu from 'defu';\nimport { defaultOptions, earlyPruneRegex, type Options } from './common.ts';\nimport babelPlugin from './babel.ts';\n\nexport default (rawOptions: Options): BunPlugin => {\n  const options = defu(rawOptions, defaultOptions);\n  const include = options.include;\n  if (!(include instanceof RegExp)) {\n    throw new Error(\n      `Unsupported 'include' options in Bun plugin. Please provide a single regular expression`,\n    );\n  }\n  if (options.exclude) {\n    throw new Error(`Unsupported 'exclude' option in Bun plugin`);\n  }\n\n  return {\n    name: 'unplugin-typegpu',\n    setup(build) {\n      build.onLoad({ filter: include }, async (args) => {\n        const text = await Bun.file(args.path).text();\n\n        // Pruning early before more expensive operations\n        if (earlyPruneRegex.every((pattern) => !pattern.test(text))) {\n          return {\n            contents: text,\n            loader: args.loader,\n          };\n        }\n\n        const result = Babel.transform(text, {\n          presets: [['typescript', { allowDeclareFields: true }]],\n          filename: args.path,\n          plugins: [babelPlugin],\n        }).code;\n\n        return {\n          contents: result ?? text,\n          loader: args.loader,\n        };\n      });\n    },\n  };\n};\n"],"mappings":"sDACA,UAAYA,MAAW,oBACvB,OAAOC,MAAU,OAIjB,IAAOC,EAASC,GAAmC,CACjD,IAAMC,EAAUC,EAAKF,EAAYG,CAAc,EACzCC,EAAUH,EAAQ,QACxB,GAAI,EAAEG,aAAmB,QACvB,MAAM,IAAI,MACR,yFACF,EAEF,GAAIH,EAAQ,QACV,MAAM,IAAI,MAAM,4CAA4C,EAG9D,MAAO,CACL,KAAM,mBACN,MAAMI,EAAO,CACXA,EAAM,OAAO,CAAE,OAAQD,CAAQ,EAAG,MAAOE,GAAS,CAChD,IAAMC,EAAO,MAAM,IAAI,KAAKD,EAAK,IAAI,EAAE,KAAK,EAG5C,GAAIE,EAAgB,MAAOC,GAAY,CAACA,EAAQ,KAAKF,CAAI,CAAC,EACxD,MAAO,CACL,SAAUA,EACV,OAAQD,EAAK,MACf,EAGF,IAAMI,EAAe,YAAUH,EAAM,CACnC,QAAS,CAAC,CAAC,aAAc,CAAE,mBAAoB,EAAK,CAAC,CAAC,EACtD,SAAUD,EAAK,KACf,QAAS,CAACK,CAAW,CACvB,CAAC,EAAE,KAEH,MAAO,CACL,SAAUD,GAAA,KAAAA,EAAUH,EACpB,OAAQD,EAAK,MACf,CACF,CAAC,CACH,CACF,CACF","names":["Babel","defu","bun_default","rawOptions","options","defu","defaultOptions","include","build","args","text","earlyPruneRegex","pattern","result","babel_default"]}